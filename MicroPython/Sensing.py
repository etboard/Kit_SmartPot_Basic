# ******************************************************************************************
# FileName     : Sensing.py
# Description  : 수분 센서만 테스트
# Author       : 손철수
# Created Date : 2024.09.09 : SCS
# Reference    :
# Modified     : 
# Modified     : 
# ******************************************************************************************


#===========================================================================================
# 기본 모듈 사용하기
#===========================================================================================
from machine import Pin
from ETboard.lib.pin_define import *                     # ETboard 핀 관련 모듈
from machine import ADC
import time

#===========================================================================================
# 아두이노 MAX 함수 구현
#===========================================================================================
def map(x,input_min,input_max,output_min,output_max):    # map 함수 정의
    return (x-input_min)*(output_max-output_min)/(input_max-input_min)+output_min


#===========================================================================================
# 전역 변수 선언
#===========================================================================================
moisture_pin = ADC(Pin(A3))                              # 토양 수분 측정 핀: A3
moisture_value =0                                        # 토양 수분 값


#===========================================================================================
def setup():                                            #  사용자 맞춤형 설정
#===========================================================================================
    moisture_pin.atten(ADC.ATTN_11DB)                    # 토양 수분 측정 센서 입력 모드 설정


#===========================================================================================
def loop():                                              # 사용자 반복 처리
#===========================================================================================
    do_sensing_proces()                                  # 센싱 처리
    time.sleep(0.1)


#===========================================================================================
def do_sensing_proces():                                 # 센싱 처리
#===========================================================================================
    # 토양 수분 값 측정하여 100분율(%)로 환산
    global moisture_value
    moisture_result = moisture_pin.read()                    # 토양 수분 측정값 저장
    #moisture_value = map(moisture_result, 0, 2800, 100, 0)   # 토양 수분 측정값 % 변환
    moisture_value = map(moisture_result, 0, 4095, 100, 0)   # 토양 수분 측정값 % 변환
    print(str(moisture_result) + ',' + str(moisture_value))


#===========================================================================================
# 시작 지점
#===========================================================================================
if __name__ == "__main__":
    setup()
    while True:
        loop()


#===========================================================================================
#                                                    
# (주)한국공학기술연구원 http://et.ketri.re.kr       
#
#===========================================================================================